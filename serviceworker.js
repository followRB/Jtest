(()=>{var t="https://joni.pyrogss.com/api";const e="id name board{id} column_values { id text title type value } assets {id public_url name} updates(limit:5){id body creator_id created_at assets {id public_url}}";async function a(t,e,a){try{let n={body:JSON.stringify(e),headers:{"Content-type":"application/json; charset=UTF-8",Authorization:`Bearer ${t}`},method:"POST"},o=await fetch("https://api.monday.com/v2",n),i=await o.json();i.original_service=a,!i.errors&&i.error_message&&(i.errors=[{message:i.error_message}]);let r={ok:200==o.status&&!i.errors,json:i};return r.ok||(r.json.query=e),r}catch{}return{ok:!1,json:{errors:["Failed To Connect monday.com API"]}}}async function n(t,e,n,o,i,r){const s={query:`mutation {create_notification (user_id: ${o}, target_id: ${n}, text: "${i}", target_type: ${r}){ id}}`};var c=await a(t,s,"create_notification");if(c.ok,c.json,!c.ok)return c.json;let d=c.json.data.create_notification;return d?(d.contact=e,d):c.json}async function o(t,n,o,i,r){const s={query:`mutation {create_subitem (parent_item_id: ${i},item_name: "${r}") {${e}}}`};var c=await a(n,s,"create_subitem");if(c.ok,c.json,!c.ok)return c.json.rollback_id=t,c.json;let d=c.json.data.create_subitem;return d.board_id=d.board.id,d.contact=o,d}async function i(t,e,n){const o={query:`mutation {create_update (item_id: ${e}, body: "${n}") {id body creator_id created_at item_id assets {id public_url}}}`};var i=await a(t,o,"create_update");return i.ok,i.json,i.ok?i.json.data.create_update:i.json}async function r(t,e,n,o,i,r){const s={query:`mutation {create_item (board_id: ${o},item_name: "${i}",column_values:${JSON.stringify(JSON.stringify(r))}) {id name board{id} column_values { id text title type value }}}`};var c=await a(e,s,"create_item");if(c.ok,c.json,!c.ok)return c.json.rollback_id=t,c.json;let d=c.json.data.create_item;return d.board_id=d.board.id,d.assets=[],d.updates=[],d.contact=n,d}async function s(t,n,o,i,r,s){const c={query:`mutation {create_item (board_id: ${i},item_name:"${r}",column_values:${JSON.stringify(JSON.stringify(s))}){${e}}}`};var d=await a(n,c,"create_contact");if(d.ok,d.json,!d.ok)return d.json.rollback_id=t,d.json;let u=d.json.data.create_item;return u.board_id=u.board.id,u.contact=o,u}async function c(t){var e=await a(t,{query:"query {me{id} users {id name account{ id name }} boards (state:active order_by:used_at) {name id columns { id title type settings_str} subscribers {id} } }"},"init_data");if(e.ok,e.json,!e.ok)return e.json;var n={},o={},i={};return e.json.data.users.forEach((t=>{n[t.id]={name:t.name,account:t.account.id},o[t.account.id]=t.account.name})),e.json.data.boards.forEach((t=>{t.columns.forEach((t=>t.settings=JSON.parse(t.settings_str))),i[t.id]=t;let e=[];t.subscribers.forEach((t=>{e.push(t.id)})),t.subscribers=e})),{users:n,accounts:o,boards:i,me:e.json.data.me.id}}async function d(t,e,n,o,i,r){"object"==typeof o&&Object.keys(o).length&&(o.changed_at=(new Date).toISOString());const s={query:`mutation {change_column_value (board_id: ${r}, item_id: ${i}, column_id: "${n}", value: ${JSON.stringify(JSON.stringify(o))}) {id}}`};var c=await a(e,s,"update_item");return c.json.rollback_id=t,c.ok,c.json,c.json}async function u(t,n){const o={query:`query {items (ids: [${n.join(",")}]) {${e}}}`};var i=await a(t,o,"get_items");return i.ok,i.json,i.ok?(i.json.data.items.forEach((t=>t.board_id=t.board.id)),i.json.data.items):i.json}async function m(t,n,o,i,r){let s=`"${n}"`;if((i??"").length&&0==n.indexOf(i)){let t=n.substr(i.length);s+=`,"${t}"`,"0"!=i&&(s+=`,"0${t}"`)}s+=`,"+${n}"`;const c={query:`query {items_by_multiple_column_values (board_id: ${o}, column_id: "${r}", column_values: [${s}],limit:1) {${e}}}`};var d=await a(t,c,"get_contact");return d.ok,d.json,d.ok?{contact:n,board_id:o,id:d.json.data?.id,column:d.json.data?.items_by_multiple_column_values}:d.json}function l(t){var e={user:"anonymous",email:"anonymous"};return""!=t.email&&""!=t.id&&(e.user=t.id,e.email=t.email),e}async function _(e){e=l(e);var a={method:"POST",body:JSON.stringify({googleId:e.email,version:chrome.runtime.getManifest().version}),headers:{"Content-type":"application/json; charset=UTF-8"}},n=await fetch(`${t}/config.php`,a);if(200==n.status){var o=await n.json();return{user:e.user,scripts:o,email:e.email,type:"yoni_configuration"}}return{}}function p(t){try{t.autoDiscardable&&chrome.tabs.update(t.id,{autoDiscardable:!1})}catch{}}function y(t){f((t=>t.forEach(p)))}function f(t){chrome.tabs.query({url:"*://*.web.whatsapp.com/*"},(e=>{e.length&&t(e)}))}function h(t,e){f((a=>{for(var n=0;n<a.length;n++){try{chrome.tabs.sendMessage(a[n].id,t,(()=>{}))}catch(t){}p(a[n])}null!=e&&e()}))}chrome.tabs.onCreated.addListener(y),chrome.tabs.onReplaced.addListener(y),chrome.runtime.onMessage.addListener((function(e,a,p){if(a.id==chrome.runtime.id){if(!e)return;"yoni_reload"==e.type?(chrome.runtime.reload(),p({type:"yoni_reloaded"})):e.activationKey||e.getYONIcfg?chrome.identity.getProfileUserInfo({accountStatus:"ANY"},(async a=>{var n={};e.activationKey?n=await async function(e,a){if("anonymous"==(a=l(a)).email)return{activated:!1};var n={method:"POST",body:JSON.stringify({googleId:a.email,activationKey:e}),headers:{"Content-type":"application/json; charset=UTF-8"}},o=await fetch(`${t}/activate.php`,n);if(200==o.status){var i=await o.json();return i.activated&&f((t=>{chrome.identity.getProfileUserInfo({accountStatus:"ANY"},(async t=>{h(await _(t))}))})),i}return{activated:!1}}(e.activationKey,a):e.getYONIcfg&&(n=await _(a)),p(n)})):e.type&&"gs_sheets"==e.type?async function(){let t=await async function(t,e,a){let n=`https://sheets.googleapis.com/v4/spreadsheets/${e}?includeGridData=true&fields=sheets/data/rowData/values/formattedValue,sheets/properties/sheetId,sheets/properties/title,properties/title,spreadsheetId&alt=json&key=${t}`;a&&(n+=`&ranges='${a}'`);let o=await fetch(n),i=await o.json();if(200==o.status){let t=i.sheets.map((function(t){try{return{columns:t.data[0].rowData[0]?.values.map((t=>t.formattedValue??"")),name:t.properties.title,id:t.properties.sheetId,rows:t.data[0].rowData.slice(1).map((t=>t.values.map((t=>t.formattedValue??""))))}}catch{}return!1})).filter((t=>t));return{spreadsheetId:i.spreadsheetId,spreadsheetTitle:i.properties.title,sheets:t}}return i.error||(i={error:i}),i}(e.key,e.spreadSheetId,e.name);p({type:"gs_sheets_res",res:t})}():e.type&&e.type.indexOf("mon_")>=0&&async function(){if(!e||!e.type)return;let t={mon_gc:{f:m,p:[e.token,e.contact,e.board_id,e.ccode,e.column_id]},mon_ui:{f:d,p:[e.rollback_id,e.token,e.column_id,e.column_values,e.item_id,e.board_id]},mon_init:{f:c,p:[e.token]},mon_gi:{f:u,p:[e.token,e.ids]},mon_gi_refresh:{f:u,p:[e.token,e.ids]},mon_cc:{f:s,p:[e.rollback_id,e.token,e.contact,e.board_id,e.contact_name??"",e.column_values]},mon_ci:{f:r,p:[e.rollback_id,e.token,e.contact,e.board_id,e.item_name,e.column_values]},mon_csi:{f:o,p:[e.rollback_id,e.token,e.contact,e.parent_item_id,e.item_name]},mon_cnot_items:{f:n,p:[e.token,e.contact,e.target_id,e.user_id,e.text,"Project"]},mon_cnot_updates:{f:n,p:[e.token,e.contact,e.target_id,e.user_id,e.text,"Post"]},mon_cu:{f:i,p:[e.token,e.item_id,e.body]}}[e.type];if(!t)return p({type:"mon_log",msg:"service not found",request:e});let a=await t.f(...t.p.filter((t=>t&&1)));"mon_init"!=e.type&&a.errors?p({type:"mon_error_res",res:a}):p({type:`${e.type}_res`,res:a})}()}return!0})),chrome.identity.onSignInChanged.addListener((function(t,e){return h({type:"sign_in_changed"}),!0})),chrome.runtime.onUpdateAvailable.addListener((t=>{h({type:"yoni_notification",message:"yoni_update_available"})})),chrome.runtime.onInstalled.addListener((function(t){y(),["install","update"].includes(t.reason)&&f((t=>t.forEach((t=>chrome.tabs.reload(t.id)))))}))})();