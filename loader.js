(()=>{function e(e,t){var a=document.createElement("input");a.type="hidden",a.id=e,a.value=chrome.runtime.getURL(`imgs/${t}.png`),document.body.appendChild(a)}var t,a,o;function s(e,t,a){var o="",s=0;for(k in a)0==k.indexOf(e)&&k.indexOf("size")<0&&(s++,o+=a[k]);postMessage({type:t,size:s,data:""==o?"NoXSA===":o})}function n(){if(chrome.runtime.lastError)return postMessage({type:"chrome_error",msg:chrome.runtime.lastError?.message}),!0}e("yoniicon","128"),e("yoniiconb","128b"),e("yoniicontimer","128_timer"),e("yoniicontimerb","128b_timer"),e("yonilogo","logo"),e("yonilogob","logob"),(t=document.createElement("input")).type="hidden",t.id="yoniversion",t.value=chrome.runtime.getManifest().version,document.body.appendChild(t),function(){var e=document.createElement("input");e.type="hidden",e.id="yonidateval",e.value=(new Date).toString(),document.body.appendChild(e)}(),chrome.runtime.onMessage.addListener((function(e,t,a){t.id==chrome.runtime.id&&("alert"==e.type?jAlert(_yoni.translate(e.message),_yoni.translate("gen_title")):"update"==e.type?jAlert(_yoni.translate("update_available"),_yoni.translate("gen_title")):postMessage(e)),null!=a&&a()})),function(){n();var e=t=>!(!["yoni_store_file","yoni_get_file","yoni_remove_file","yoni_get_all_files","yoni_clear_all_files"].includes(t.data?.type)||(chrome?.storage?.local?"yoni_get_file"==t.data.type?(chrome.storage.local.get(t.data.fid,(function(e){n()||postMessage({type:"yoni_get_file_res",fid:t.data.fid,result:e})})),0):"yoni_clear_all_files"==t.data.type?(chrome.storage.local.clear(n),0):"yoni_remove_file"==t.data.type?(chrome.storage.local.remove(t.data.fid,(function(e){n()||postMessage({type:"log",data:{tp:"yoni_remove_file",result:e}})})),0):"yoni_store_file"==t.data.type?(chrome.storage.local.set(t.data.data,(function(e){n()||postMessage({type:"log",data:{tp:"yoni_store_file",result:e}})})),0):"yoni_get_all_files"==t.data.type&&(chrome.storage.local.get(null,(function(e){n()||postMessage({type:"yoni_get_all_files_res",result:e})})),0):(setTimeout((()=>e(t)),250),0))),t=e=>{if(!["clear_storage","load_yoni_sync_storage","save_yoni_gs","save_yoni_tm","save_yoni_mh","save_yoni_mon_tok","save_yoni_notes","save_yoni_templates"].includes(e.data?.type))return!1;if(!chrome?.storage?.sync)return setTimeout((()=>t(e)),250),!0;if("clear_storage"==e.data.type)return chrome.storage.sync.clear(n),!0;if(!e.data.type.indexOf("save_yoni_"))return function(e){e.data.keys_to_remove.length&&chrome.storage.sync.remove(e.data.keys_to_remove,n),chrome.storage.sync.set(e.data.data,(function(e){n()}))}(e),!0;if("load_yoni_sync_storage"==e.data.type){var a=[],o=["yoni_templates","yoni_mon_tok","yoni_notes","yoni_mh","yoni_tm","yoni_gs"];return o.forEach((t=>a.push(`${t}_${e.data.user}`))),postMessage({type:"log",data:a}),postMessage({type:"log",data:o}),function(e,t){chrome.storage.sync.get(null,(function(a){if(!n()){postMessage({type:"log",data:a});for(var o=0;o<e.length;o++)s(e[o],t[o],a)}}))}(a,o),!0}},d=[e=>!!["mon_gi_refresh","mon_gi","mon_gc","mon_ui","mon_init","mon_cc","mon_ci","mon_cu","mon_csi","mon_test","mon_cnot_items"].includes(e.data?.type)&&("mon_test"==e.data?.type?(console.log(e.data),!0):(chrome.runtime.sendMessage(e.data,(e=>{n(),postMessage(e)})),!0)),t,e,e=>!!e.data.getYONIcfg&&(chrome.runtime.sendMessage({getYONIcfg:!0},(e=>postMessage(e))),!0),e=>{if(!["yoni_preview"].includes(e.data?.type))return!1;let t=e.data;return chrome.runtime.sendMessage({type:t.type,url:t.url},(e=>{n(),postMessage(e)})),!0},e=>"yoni_reload"==e.data.type&&(chrome.runtime.sendMessage(e.data,(e=>{n(),postMessage(e)})),!0),e=>"Activate"==e.data.type&&(e.data.activationKey?chrome.runtime.sendMessage({activationKey:e.data.activationKey},(t=>{n(),postMessage(t),postMessage({type:"yoni_alert",desc:t.activated?"activation_success":"activation_failed",vars:[e.data.user]})})):postMessage({type:"yoni_alert",desc:"empty_activation_key",vars:[]}),!0),e=>{if("yoni_fb_send_remove"!=e.data.type)return!1;if(i.keepCopy){var t=e.data.sent?"sent":"notsent";o.database().ref(`${i.store}/${t}/${e.data.key}`).set(e.data.data).then((()=>{o.database().ref(`${i.store}/send/${e.data.key}`).remove()}),(e=>console.log("err set to sent:",e)))}else e.data.sent?o.database().ref(`${i.store}/send/${e.data.key}`).remove():o.database().ref(`${i.store}/notsent/${e.data.key}`).set(e.data.data).then((()=>{o.database().ref(`${i.store}/send/${e.data.key}`).remove()}),(e=>console.log("err set to sent:",e)));return n(),!0},e=>!!["yoni_fb_activate","yoni_fb_deactivate"].includes(e.data.type)&&("yoni_fb_activate"==e.data.type?async function(e){try{i=e,o=firebase.initializeApp({databaseURL:e.dbUrl});var t=`${e.store}/send`;e.discard&&await o.database().ref(t).remove(),(a=o.database().ref(t)).on("child_added",r)}catch(e){console.log(e)}}(e.data.settings):(a?.off("child_added",r),o?.delete(),a=null,o=null),!0),e=>{if(!["gs_sheets"].includes(e.data?.type))return!1;let t=e.data;return chrome.runtime.sendMessage({type:t.type,spreadSheetId:t.id,key:t.key,name:t.name},(e=>{n(),postMessage(e)})),!0}];window.onmessage=e=>{if(e.data)for(var t=0;t<d.length&&!d[t](e);t++);}}(),["joni.js"].forEach((e=>{var t=document.createElement("script");t.src=chrome.runtime.getURL(e),document.body.appendChild(t),t.remove()}));var i=!1;function r(e){postMessage({type:"yoni_fb_send",data:e.val(),key:e.key})}})();